
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[1]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[2]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">%</span><span class="k">matplotlib</span> <span class="n">inline</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">4.5</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;axes.grid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>
&lt;matplotlib.figure.Figure at 0x7fc1f688d710&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The aim of this notebook is to make a submission for this competition as quickly as possible. Just want to get something in.</p>
<h1 id="loading-the-data">Loading the data</h1>
<p>Getting all the filenames for Dog_1 ready, going to do the analysis on this first, then iterate over the rest after that.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[3]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">cd</span> <span class="o">..</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
/home/gavin/repositories/hail-seizure

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[4]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">train</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">imp</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[5]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">imp</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[5]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
&lt;module &apos;train&apos; from &apos;/home/gavin/repositories/hail-seizure/train.py&apos;&gt;
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, have to load the settings from the json file:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[6]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">settings</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;SETTINGS.json&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[7]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">settings</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[7]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
dict_keys([&apos;SUBMISSION_PATH&apos;, &apos;TRAIN_DATA_PATH&apos;, &apos;_FEATURES&apos;, &apos;MODEL_PATH&apos;, &apos;VERSION&apos;, &apos;FEATURES&apos;, &apos;RAW_DATA_DIRS&apos;, &apos;SUBJECTS&apos;, &apos;TEST_DATA_PATH&apos;])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[8]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">data</span> <span class="o">=</span> <span class="n">train</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">settings</span><span class="p">[</span><span class="s">&#39;FEATURES&#39;</span><span class="p">])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Doing this we get a dictionary of dictionarys:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[10]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[10]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
dict
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[11]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[11]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
dict_keys([&apos;raw_feat_var_&apos;, &apos;raw_feat_pib_&apos;, &apos;raw_feat_corrcoef_&apos;, &apos;raw_feat_cov_&apos;, &apos;raw_feat_xcorr_&apos;])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[12]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">data</span><span class="p">[</span><span class="s">&#39;raw_feat_var_&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[12]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
dict_keys([&apos;Patient_2&apos;, &apos;Dog_3&apos;, &apos;Patient_1&apos;, &apos;Dog_1&apos;, &apos;Dog_4&apos;, &apos;Dog_2&apos;, &apos;Dog_5&apos;])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[13]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">data</span><span class="p">[</span><span class="s">&#39;raw_feat_var_&#39;</span><span class="p">][</span><span class="s">&#39;Patient_2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[13]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
dict_keys([&apos;interictal&apos;, &apos;preictal&apos;, &apos;test&apos;])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[14]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">data</span><span class="p">[</span><span class="s">&#39;raw_feat_var_&#39;</span><span class="p">][</span><span class="s">&#39;Patient_2&#39;</span><span class="p">][</span><span class="s">&#39;interictal&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[14]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
dict_keys([&apos;Patient_2_interictal_segment_0034.mat&apos;, &apos;Patient_2_interictal_segment_0013.mat&apos;, &apos;Patient_2_interictal_segment_0016.mat&apos;, &apos;Patient_2_interictal_segment_0040.mat&apos;, &apos;Patient_2_interictal_segment_0007.mat&apos;, &apos;Patient_2_interictal_segment_0039.mat&apos;, &apos;Patient_2_interictal_segment_0012.mat&apos;, &apos;Patient_2_interictal_segment_0033.mat&apos;, &apos;Patient_2_interictal_segment_0035.mat&apos;, &apos;Patient_2_interictal_segment_0006.mat&apos;, &apos;Patient_2_interictal_segment_0020.mat&apos;, &apos;Patient_2_interictal_segment_0015.mat&apos;, &apos;Patient_2_interictal_segment_0028.mat&apos;, &apos;Patient_2_interictal_segment_0003.mat&apos;, &apos;Patient_2_interictal_segment_0008.mat&apos;, &apos;Patient_2_interictal_segment_0014.mat&apos;, &apos;Patient_2_interictal_segment_0002.mat&apos;, &apos;Patient_2_interictal_segment_0022.mat&apos;, &apos;Patient_2_interictal_segment_0005.mat&apos;, &apos;Patient_2_interictal_segment_0029.mat&apos;, &apos;Patient_2_interictal_segment_0032.mat&apos;, &apos;Patient_2_interictal_segment_0025.mat&apos;, &apos;Patient_2_interictal_segment_0037.mat&apos;, &apos;Patient_2_interictal_segment_0036.mat&apos;, &apos;Patient_2_interictal_segment_0009.mat&apos;, &apos;Patient_2_interictal_segment_0019.mat&apos;, &apos;Patient_2_interictal_segment_0041.mat&apos;, &apos;Patient_2_interictal_segment_0011.mat&apos;, &apos;Patient_2_interictal_segment_0027.mat&apos;, &apos;Patient_2_interictal_segment_0023.mat&apos;, &apos;Patient_2_interictal_segment_0010.mat&apos;, &apos;Patient_2_interictal_segment_0042.mat&apos;, &apos;Patient_2_interictal_segment_0004.mat&apos;, &apos;Patient_2_interictal_segment_0030.mat&apos;, &apos;Patient_2_interictal_segment_0018.mat&apos;, &apos;Patient_2_interictal_segment_0026.mat&apos;, &apos;Patient_2_interictal_segment_0038.mat&apos;, &apos;Patient_2_interictal_segment_0001.mat&apos;, &apos;Patient_2_interictal_segment_0021.mat&apos;, &apos;Patient_2_interictal_segment_0031.mat&apos;, &apos;Patient_2_interictal_segment_0024.mat&apos;, &apos;Patient_2_interictal_segment_0017.mat&apos;])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's dictionaries <strong>all the way down</strong>.</p>
<p>Until you get to the feature vectors, obviously:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[16]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">data</span><span class="p">[</span><span class="s">&#39;raw_feat_var_&#39;</span><span class="p">][</span><span class="s">&#39;Patient_2&#39;</span><span class="p">][</span><span class="s">&#39;interictal&#39;</span><span class="p">][</span><span class="s">&#39;Patient_2_interictal_segment_0034.mat&#39;</span><span class="p">]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[16]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
array([[ 27997.01668904],
       [ 35989.2985339 ],
       [ 37794.52532364],
       [  6949.26002361],
       [  5195.24778149],
       [  3510.06425946],
       [  2179.78818952],
       [  1385.7960766 ],
       [ 11534.77415212],
       [ 12426.21191639],
       [ 14570.52442261],
       [ 23987.76874976],
       [ 19616.06321446],
       [ 19970.38598875],
       [  3789.33438728],
       [  1386.13668337],
       [  2801.36957988],
       [  4358.93826166],
       [ 19564.32297182],
       [ 22553.67189286],
       [  6853.33525793],
       [  6837.8633967 ],
       [  1925.52227487],
       [  1133.48431202]])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unfortunately, we want a feature matrix and a target vector to shove into whatever machine learning code we want to use. Should be pretty easy to get that out of the above data structure though. Requirements of this code:</p>
<ul>
<li><strong>Input</strong>: subject, features, data</li>
<li><strong>Output</strong>_: X feature matrix, y target vector</li>
</ul>
<p>Prototyping this function in this notebook, then will save to <code>utils.py</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[19]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[51]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">buildtraining</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to build data structures for ML:</span>
<span class="sd">    </span>
<span class="sd">    * __Input__: subject, features</span>
<span class="sd">    * __Output___: X feature matrix, y target vector</span>
<span class="sd">    </span>
<span class="sd">    It will not tell you which feature is which.&quot;&quot;&quot;</span>
    <span class="c"># hacking this for later</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">Xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="c"># enumerate to get numbers for target vector:</span>
        <span class="c">#     0 is interictal</span>
        <span class="c">#     1 is preictal</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ictal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;interictal&#39;</span><span class="p">,</span><span class="s">&#39;preictal&#39;</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">subject</span><span class="p">][</span><span class="n">ictal</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c"># now stack up the feature vectors</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">Xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Xf</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">subject</span><span class="p">][</span><span class="n">ictal</span><span class="p">][</span><span class="n">segment</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">Xf</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">subject</span><span class="p">][</span><span class="n">ictal</span><span class="p">][</span><span class="n">segment</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
                <span class="c"># and stack up the target vector</span>
                <span class="c"># but only for the first feature (will be the same for the rest)</span>
                <span class="k">if</span> <span class="n">feature</span> <span class="o">==</span> <span class="n">first</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c"># stick the X arrays together</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span><span class="n">Xf</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">Xf</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">Xf</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c"># turn y into an array</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>How the enumerate works:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[21]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;interictal&#39;</span><span class="p">,</span><span class="s">&#39;preictal&#39;</span><span class="p">]):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
0 interictal
1 preictal

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Testing the above:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[41]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">buildtraining</span><span class="p">(</span><span class="s">&#39;Dog_1&#39;</span><span class="p">,[</span><span class="s">&#39;raw_feat_var_&#39;</span><span class="p">,</span><span class="s">&#39;raw_feat_cov_&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[43]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[43]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
(504, 136)
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[44]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[44]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
(504,)
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Appears to have worked.</p>
<p>Attempting on all features.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[52]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">buildtraining</span><span class="p">(</span><span class="s">&#39;Dog_1&#39;</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">data</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
raw_feat_pib_
(504, 16) (504, 16, 6)
raw_feat_xcorr_
(504, 256) (504, 120, 2)

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Caught the above errors, looks like those two features are a bit weird. Maybe they're not coming in as vectors?</p>
<p>Should probably just flatten them.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[56]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">buildtraining</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to build data structures for ML:</span>
<span class="sd">    </span>
<span class="sd">    * __Input__: subject, features</span>
<span class="sd">    * __Output___: X feature matrix, y target vector</span>
<span class="sd">    </span>
<span class="sd">    It will not tell you which feature is which.&quot;&quot;&quot;</span>
    <span class="c"># hacking this for later</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">Xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
        <span class="c"># enumerate to get numbers for target vector:</span>
        <span class="c">#     0 is interictal</span>
        <span class="c">#     1 is preictal</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ictal</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;interictal&#39;</span><span class="p">,</span><span class="s">&#39;preictal&#39;</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">subject</span><span class="p">][</span><span class="n">ictal</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="c"># now stack up the feature vectors</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">Xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">Xf</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">subject</span><span class="p">][</span><span class="n">ictal</span><span class="p">][</span><span class="n">segment</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)])</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">Xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">subject</span><span class="p">][</span><span class="n">ictal</span><span class="p">][</span><span class="n">segment</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                <span class="c"># and stack up the target vector</span>
                <span class="c"># but only for the first feature (will be the same for the rest)</span>
                <span class="k">if</span> <span class="n">feature</span> <span class="o">==</span> <span class="n">first</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c"># stick the X arrays together</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">X</span><span class="p">,</span><span class="n">Xf</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">Xf</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">Xf</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c"># turn y into an array</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">y</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[57]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">buildtraining</span><span class="p">(</span><span class="s">&#39;Dog_1&#39;</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">data</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, now appears to work.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[82]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">%</span><span class="k">save</span> <span class="n">buildtraining</span><span class="o">.</span><span class="n">py</span> <span class="mi">56</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
The following commands were written to file &#96;buildtraining.py&#96;:
def buildtraining(subject,features,data):
    &quot;&quot;&quot;Function to build data structures for ML:
    
    * __Input__: subject, features
    * __Output___: X feature matrix, y target vector
    
    It will not tell you which feature is which.&quot;&quot;&quot;
    # hacking this for later
    first = features[0]
    for feature in features:
        Xf = np.array([])
        # enumerate to get numbers for target vector:
        #     0 is interictal
        #     1 is preictal
        for i,ictal in enumerate([&apos;interictal&apos;,&apos;preictal&apos;]):
            for segment in data[feature][subject][ictal].keys():
                # now stack up the feature vectors
                try:
                    Xf = np.vstack([Xf,np.ndarray.flatten(data[feature][subject][ictal][segment].T)])
                except ValueError:
                    Xf = np.ndarray.flatten(data[feature][subject][ictal][segment].T)
                # and stack up the target vector
                # but only for the first feature (will be the same for the rest)
                if feature == first:
                    try:
                        y.append(i)
                    except NameError:
                        y = [i]
        # stick the X arrays together
        try:
            X = np.hstack([X,Xf])
        except NameError:
            X = Xf
        except ValueError:
            print(feature)
            print(X.shape,Xf.shape)
    # turn y into an array
    y = np.array(y)
    return X,y

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="learning">Learning</h1>
<p>Now we can actually do all the machine learning we need to do to make a submission. Not even bothering with feature selection, just going to build a pipeline and run K-fold cross validation.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[65]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">sklearn.preprocessing</span>
<span class="kn">import</span> <span class="nn">sklearn.pipeline</span>
<span class="kn">import</span> <span class="nn">sklearn.ensemble</span>
<span class="kn">import</span> <span class="nn">sklearn.cross_validation</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[64]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">scaler</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">preprocessing</span><span class="o">.</span><span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">forest</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">pipeline</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">([(</span><span class="s">&#39;scl&#39;</span><span class="p">,</span><span class="n">scaler</span><span class="p">),(</span><span class="s">&#39;clf&#39;</span><span class="p">,</span><span class="n">forest</span><span class="p">)])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Starting with default settings:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[76]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">tenfold</span> <span class="o">=</span> <span class="n">sklearn</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">n_folds</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[77]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">sklearn</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="n">tenfold</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[77]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
array([ 0.94117647,  0.94117647,  0.96078431,  0.94117647,  0.96      ,
        0.96      ,  0.96      ,  0.96      ,  0.96      ,  0.96      ])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Not that impressive, when you look at the all zeros for this one.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[80]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="mi">1</span><span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[80]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
0.95238095238095233
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Trying increasing the number of trees we're using.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[84]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">model</span><span class="o">.</span><span class="n">set_params</span><span class="err">?</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[87]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">model</span><span class="o">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">clf__n_estimators</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[87]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
Pipeline(steps=[(&apos;scl&apos;, StandardScaler(copy=True, with_mean=True, with_std=True)), (&apos;clf&apos;, RandomForestClassifier(bootstrap=True, compute_importances=None,
            criterion=&apos;gini&apos;, max_depth=None, max_features=&apos;auto&apos;,
            max_leaf_nodes=None, min_density=None, min_samples_leaf=1,
            min_samples_split=2, n_estimators=3000, n_jobs=1,
            oob_score=False, random_state=None, verbose=0))])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[92]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">sklearn</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="n">tenfold</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[92]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
array([ 0.94117647,  0.94117647,  0.94117647,  0.94117647,  0.96      ,
        0.96      ,  0.96      ,  0.96      ,  0.96      ,  0.96      ])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[94]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">sklearn</span><span class="o">.</span><span class="n">cross_validation</span><span class="o">.</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">cv</span><span class="o">=</span><span class="n">tenfold</span><span class="p">,</span><span class="n">scoring</span><span class="o">=</span><span class="s">&#39;roc_auc&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[94]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
array([ 0.94444444,  0.72569444,  0.77777778,  0.95833333,  0.9375    ,
        1.        ,  0.84375   ,  0.76041667,  0.546875  ,  0.875     ])
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Well, that's not below 0.5, so that's good enough for a submission. Time to go ahead and do that.</p>
<p>So, I'll need another function like the one above to create a test matrix for each subject. Then, I can iterate over subjects, training the model and then classifying the test.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[139]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">def</span> <span class="nf">buildtest</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Function to build data structures for submission:</span>
<span class="sd">    </span>
<span class="sd">    * __Input__: subject, features, data</span>
<span class="sd">    * __Output___: X feature matrix, labels</span>
<span class="sd">    </span>
<span class="sd">    It will not tell you which feature is which.&quot;&quot;&quot;</span>
    <span class="n">Xd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">subject</span><span class="p">][</span><span class="s">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">fvector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">][</span><span class="n">subject</span><span class="p">][</span><span class="s">&#39;test&#39;</span><span class="p">][</span><span class="n">segment</span><span class="p">])</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">Xd</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Xd</span><span class="p">[</span><span class="n">segment</span><span class="p">],</span><span class="n">fvector</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">Xd</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">fvector</span>
    <span class="c"># make the X array and corresponding labels</span>
    <span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">Xd</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">segment</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Xd</span><span class="p">[</span><span class="n">segment</span><span class="p">])</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span><span class="n">segments</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[102]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">subjects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">features</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Had to remove this feature as it didn't cover all subjects for some reason.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[117]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">features</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&#39;raw_feat_xcorr_&#39;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[140]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">X</span><span class="p">,</span><span class="n">segments</span> <span class="o">=</span> <span class="n">buildtest</span><span class="p">(</span><span class="n">subjects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">features</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[141]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[141]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
150
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[142]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">X</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">
    Out[142]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
(150, 720)
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Works, but not saving as I want to reorganise the code I already saved as well.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[147]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">%%</span><span class="k">time</span>
<span class="n">predictiondict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">subj</span> <span class="ow">in</span> <span class="n">subjects</span><span class="p">:</span>
    <span class="c"># training step</span>
    <span class="n">X</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">buildtraining</span><span class="p">(</span><span class="n">subj</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="c"># prediction step</span>
    <span class="n">X</span><span class="p">,</span><span class="n">segments</span> <span class="o">=</span> <span class="n">buildtest</span><span class="p">(</span><span class="n">subj</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">segment</span><span class="p">,</span><span class="n">prediction</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span><span class="n">predictions</span><span class="p">):</span>
        <span class="n">predictiondict</span><span class="p">[</span><span class="n">segment</span><span class="p">]</span> <span class="o">=</span> <span class="n">prediction</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
CPU times: user 1min 17s, sys: 13.3 ms, total: 1min 17s
Wall time: 1min 17s

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="saving-results-to-csv">Saving results to csv</h1>
<p>Have to save these results to the csv form requested:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[149]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">csv</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[152]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&quot;output/protosubmission.csv&quot;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">c</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s">&#39;clip&#39;</span><span class="p">,</span><span class="s">&#39;preictal&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">predictiondict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">c</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">seg</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="k">predictiondict</span><span class="p">[</span><span class="n">seg</span><span class="p">]])</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[153]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">!</span>head output/protosubmission.csv
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>











</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In&nbsp;[154]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="o">!</span>wc -l output/protosubmission.csv
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
3936 output/protosubmission.csv

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Looks like it's the right length. Submitted now and we got 0.59308 for it, which isn't too bad.</p>
</div>
</div>
</div>